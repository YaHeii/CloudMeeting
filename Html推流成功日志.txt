[2025-10-28T03:04:14.955Z] INFO: 开始推流流程，目标 SRS: webrtc://10.0.0.10/live/teststream
[2025-10-28T03:04:22.111Z] INFO: 获取到本地媒体流 {"tracks":[{"kind":"audio","enabled":true},{"kind":"video","enabled":true}]}
[2025-10-28T03:04:22.115Z] INFO: 已向 PeerConnection 添加轨道 {"kind":"audio","id":"52ba56e0-f12a-4a6d-a7a4-34794ce19c49"}
[2025-10-28T03:04:22.118Z] INFO: 已向 PeerConnection 添加轨道 {"kind":"video","id":"0ced0955-62fd-480e-878f-1820a88d1ea4"}
[2025-10-28T03:04:22.124Z] INFO: negotiationneeded 触发
[2025-10-28T03:04:22.126Z] INFO: 创建 Offer SDP 长度: 5632
[2025-10-28T03:04:22.133Z] INFO: 已设置本地描述 (offer)
[2025-10-28T03:04:22.134Z] INFO: 发送 Offer 到 SRS URL: http://10.0.0.10:1985/rtc/v1/publish/
[2025-10-28T03:04:22.140Z] INFO: 产生 ICE candidate {"candidate":"candidate:3687425807 1 udp 2113937151 861d7475-284f-4e83-911e-58402032d951.local 60737 typ host generation 0 ufrag nvyB network-cost 999","sdpMid":"0","sdpMLineIndex":0,"usernameFragment":"nvyB"}
[2025-10-28T03:04:22.142Z] INFO: 产生 ICE candidate {"candidate":"candidate:3687425807 1 udp 2113937151 861d7475-284f-4e83-911e-58402032d951.local 60739 typ host generation 0 ufrag nvyB network-cost 999","sdpMid":"1","sdpMLineIndex":1,"usernameFragment":"nvyB"}
[2025-10-28T03:04:22.185Z] INFO: 从 SRS 收到响应 JSON {
"code":0,"server":"vid-ki8te26","service":"u2hr8o54","pid":"1","sdp":"v=0\r\no=SRS/6.0.181(Hang) 99902663285360 2 IN IP4 0.0.0.0\r\n
s=SRSPublishSession\r\nt=0 0\r\n
a=ice-lite\r\na=group:BUNDLE 0 1\r\n
a=msid-semantic: WMS live/teststream\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111\r\nc=IN IP4 0.0.0.0\r\n
a=ice-ufrag:84a9c6ot\r\na=ice-pwd:q354k8290x866mz09244qh6r3656t53z\r\n
a=fingerprint:sha-256 3B:76:3C:67:22:69:7C:A2:C3:93:1A:32:ED:41:3A:E7:5C:AA:37:F5:A6:E3:70:9E:4E:3A:93:39:FE:65:1B:6D\r\na=setup:passive\r\na=mid:0\r\n
a=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\n
a=recvonly\r\na=rtcp-mux\r\na=rtcp-rsize\r\n
a=rtpmap:111 opus/48000/2\r\n
a=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=candidate:0 1 udp 2130706431 10.0.0.10 8000 typ host generation 0\r\n
a=candidate:1 1 udp 2130706431 172.17.0.2 8000 typ host generation 0\r\nm=video 9 UDP/TLS/RTP/SAVPF 109 123\r\nc=IN IP4 0.0.0.0\r\n
a=ice-ufrag:84a9c6ot\r\n
a=ice-pwd:q354k8290x866mz09244qh6r3656t53z\r\n
a=fingerprint:sha-256 3B:76:3C:67:22:69:7C:A2:C3:93:1A:32:ED:41:3A:E7:5C:AA:37:F5:A6:E3:70:9E:4E:3A:93:39:FE:65:1B:6D\r\n
a=setup:passive\r\na=mid:1\r\n
a=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\n
a=recvonly\r\n
a=rtcp-mux\r\na=rtcp-rsize\r\n
a=rtpmap:109 H264/90000\r\n
a=rtcp-fb:109 transport-cc\r\n
a=rtcp-fb:109 nack\r\na=rtcp-fb:109 nack pli\r\na=fmtp:109 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f\r\n
a=rtpmap:123 red/90000\r\na=candidate:0 1 udp 2130706431 10.0.0.10 8000 typ host generation 0\r\n
a=candidate:1 1 udp 2130706431 172.17.0.2 8000 typ host generation 0\r\n","sessionid":"84a9c6ot:nvyB"}
[2025-10-28T03:04:22.192Z] INFO: iceConnectionState: checking
[2025-10-28T03:04:22.195Z] INFO: 已设置远端描述 (answer)
[2025-10-28T03:04:22.196Z] INFO: 推流成功，已连接到 SRS，建议在播放器中查看流。
[2025-10-28T03:04:26.828Z] INFO: connectionState: connecting
[2025-10-28T03:04:26.831Z] INFO: ICE candidate 已结束（null 表示完成）
[2025-10-28T03:04:35.057Z] WARN: 手动停止推流
[2025-10-28T03:04:35.061Z] WARN: PeerConnection closed
[2025-10-28T03:04:35.067Z] WARN: 本地媒体流已停止



SRS日志
[2025-10-28 03:04:22.154][INFO][1][8u0718x9] new rtc source, stream_url=/live/teststream

[2025-10-28 03:04:22.157][INFO][1][8u0718x9] RTC publisher nack=1, nnc=1, pt-drop=0, twcc=1/3

[2025-10-28 03:04:22.157][INFO][1][8u0718x9] free rtc source id=[]

[2025-10-28 03:04:22.157][INFO][1][8u0718x9] new live source, stream_url=/live/teststream

[2025-10-28 03:04:22.160][INFO][1][8u0718x9] RTC: Init tracks {track: 0ced0955-62fd-480e-878f-1820a88d1ea4, is_active: 0=>1},{track: 52ba56e0-f12a-4a6d-a7a4-34794ce19c49, is_active: 0=>1}, ok

[2025-10-28 03:04:22.160][INFO][1][8u0718x9] Best matched ip=172.17.0.2, ifname=eth0

[2025-10-28 03:04:22.160][INFO][1][8u0718x9] RTC: Use candidates 10.0.0.10, 172.17.0.2, protocol=udp

[2025-10-28 03:04:22.170][INFO][1][8u0718x9] RTC init session, user=84a9c6ot:nvyB, url=/live/teststream, encrypt=1/1, DTLS(role=passive, version=auto), timeout=30000ms, nack=1

[2025-10-28 03:04:22.171][INFO][1][8u0718x9] RTC username=84a9c6ot:nvyB, offer=5632B, answer=1592B

[2025-10-28 03:04:22.171][INFO][1][8u0718x9] RTC remote offer: 
v=0\r\n
o=- 7163409617435952998 2 IN IP4 127.0.0.1\r\n
s=-\r\n
t=0 0\r\n
a=group:BUNDLE 0 1\r\n
a=extmap-allow-mixed\r\n
a=msid-semantic: WMS 9e9126ac-00ee-411c-bd6f-37563df8c4bc\r\n
m=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\r\n
c=IN IP4 0.0.0.0\r\n
a=rtcp:9 IN IP4 0.0.0.0\r\n
a=ice-ufrag:nvyB\r\n
a=ice-pwd:CY7WDEd+u5xbymJo2IRMzPI8\r\n
a=ice-options:trickle\r\n
a=fingerprint:sha-256 49:DD:3C:23:52:47:42:21:6D:EA:3C:D4:E6:ED:14:37:8A:EE:6B:48:9E:23:45:22:B4:9B:FB:B1:DC:39:74:62\r\n
a=setup:actpass\r\n
a=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\r\n
a=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\n
a=extmap:3⁠ http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\n
a=extmap:4⁠ urn:ietf:params:rtp-hdrext:sdes:mid\r\na=sendrecv\r\n
a=msid:9e9126ac-00ee-411c-bd6f-37563df8c4bc 52ba56e0-f12a-4a6d-a7a4-34794ce19c49\r\n
a=rtcp-mux\r\n
a=rtcp-rsize\r\n
a=rtpmap:111 opus/48000/2\r\n
a=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\n
a=rtpmap:63 red/48000/2\r\n
a=fmtp:63 111/111\r\n
a=rtpmap:9 G722/8000\r\n
a=rtpmap:0 PCMU/8000\r\n
a=rtpmap:8 PCMA/8000\r\n
a=rtpmap:13 CN/8000\r\n
a=rtpmap:110 telephone-event/48000\r\n
a=rtpmap:126 telephone-event/8000\r\n
a=ssrc:4069042213 cname:eTFvCfcQfV0f9mp+\r\n
a=ssrc:4069042213 msid:9e9126ac-00ee-411c-bd6f-37563df8c4bc 52ba56e0-f12a-4a6d-a7a4-34794ce19c49\r\n
m=video 9 UDP/TLS/RTP/SAVPF 96 97 103 104 107 108 109 114 115 116 117 118 39 40 45 46 98 99 100 101 119 120 123 124 125\r\n
c=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\n
a=ice-ufrag:nvyB\r\n
a=ice-pwd:CY7WDEd+u5xbymJo2IRMzPI8\r\n
a=ice-options:trickle\r\n
a=fingerprint:sha-256 49:DD:3C:23:52:47:42:21:6D:EA:3C:D4:E6:ED:14:37:8A:EE:6B:48:9E:23:45:22:B4:9B:FB:B1:DC:39:74:62\r\n
a=setup:actpass\r\na=mid:1\r\n
a=extmap:14 urn:ietf:params:rtp-hdrext:toffset\r\n
a=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\n
a=extmap:13⁠ urn:3gpp:video-orientation\r\n
a=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\n
a=extmap:5⁠ http://www.webrtc.org/experiments/rtp-hdrext/playout-delay\r\na=extmap:6⁠ http://www.webrtc.org/experiments/rtp-hdrext/video-content-type\r\n
a=extmap:7⁠ http://www.webrtc.org/experiments/rtp-hdrext/video-timing\r\na=extmap:8⁠ http://www.webrtc.org/experiments/rtp-hdrext/color-space\r\n
a=extmap:4⁠ urn:ietf:params:rtp-hdrext:sdes:mid\r\n
a=extmap:10 urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id\r\n
a=extmap:11 urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id\r\n
a=sendrecv\r\n
a=msid:9e9126ac-00ee-411c-bd6f-37563df8c4bc 0ced0955-62fd-480e-878f-1820a88d1ea4\r\n
a=rtcp-mux\r\n
a=rtcp-rsize\r\n
a=rtpmap:96 VP8/90000\r\n
a=rtcp-fb:96 goog-remb\r\n
a=rtcp-fb:96 transport-cc\r\n
a=rtcp-fb:96 ccm fir\r\n
a=rtcp-fb:96 nack\r\na=rtcp-fb:96 nack pli\r\n
a=rtpmap:97 rtx/90000\r\n
a=fmtp:97 apt=96\r\n
a=rtpmap:103 H264/90000\r\n
a=rtcp-fb:103 goog-remb\r\na=rtcp-fb:103 transport-cc\r\n
a=rtcp-fb:103 ccm fir\r\n
a=rtcp-fb:103 nack\r\na=rtcp-fb:103 nack pli\r\n
a=fmtp:103 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42001f\r\n
a=rtpmap:104 rtx/90000\r\n
a=fmtp:104 apt=103\r\na=rtpmap:107 H264/90000\r\n
a=rtcp-fb:107 goog-remb\r\na=rtcp-fb:107 transport-cc\r\n
a=rtcp-fb:107 ccm fir\r\na=rtcp-fb:107 nack\r\na=rtcp-fb:107 nack pli\r\n
a=fmtp:107 level-asymmetry-allowed=1;packetization-mode=0;profile-level-id=42001f\r\n
a=rtpmap:108 rtx/90000\r\na=fmtp:108 apt=107\r\na=rtpmap:109 H264/90000\r\na=rtcp-fb:109 goog-remb\r\n
a=rtcp-fb:109 transport-cc\r\na=rtcp-fb:109 ccm fir\r\na=rtcp-fb:109 nack\r\na=rtcp-fb:109 nack pli\r\n
a=fmtp:109 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f\r\na=rtpmap:114 rtx/90000\r\n
a=fmtp:114 apt=109\r\na=rtpmap:115 H264/90000\r\na=rtcp-fb:115 goog-remb\r\na=rtcp-fb:115 transport-cc\r\na=rtcp-fb:115 ccm fir\r\n
a=rtcp-fb:115 nack\r\na=rtcp-fb:115 nack pli\r\na=fmtp:115 level-asymmetry-allowed=1;packetization-mode=0;profile-level-id=42e01f\r\n
a=rtpmap:116 rtx/90000\r\na=fmtp:116 apt=115\r\na=rtpmap:117 H264/90000\r\na=rtcp-fb:117 goog-remb\r\na=rtcp-fb:117 transport-cc\r\n
=rtcp-fb:117 ccm fir\r\na=rtcp-fb:117 nack\r\na=rtcp-fb:117 nack pli\r\na=fmtp:117 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=4d001f\r\n
a=rtpmap:118 rtx/90000\r\na=fmtp:118 apt=117\r\na=rtpmap:39 H264/90000\r\na=rtcp-fb:39 goog-remb\r\na=rtcp-fb:39 transport-cc\r\na=rtcp-fb:39 ccm fir\r\na=rtcp-fb:39 nack\r\n
a=rtcp-fb:39 nack pli\r\na=fmtp:39 level-asymmetry-allowed=1;packetization-mode=0;profile-level-id=4d001f\r\na=rtpmap:40 rtx/90000\r\na=fmtp:40 apt=39\r\na=rtpmap:45 AV1/90000\r\n
a=rtcp-fb:45 goog-remb\r\na=rtcp-fb:45 transport-cc\r\na=rtcp-fb:45 ccm fir\r\na=rtcp-fb:45 nack\r\na=rtcp-fb:45 nack pli\r\na=fmtp:45 level-idx=5;profile=0;tier=0\r\na=rtpmap:46 rtx/90000\r\n
a=fmtp:46 apt=45\r\na=rtpmap:98 VP9/90000\r\na=rtcp-fb:98 goog-remb\r\na=rtcp-fb:98 transport-cc\r\na=rtcp-fb:98 ccm fir\r\na=rtcp-fb:98 nack\r\na=rtcp-fb:98 nack pli\r\na=fmtp:98 profile-id=0\r\n
a=rtpmap:99 rtx/90000\r\na=fmtp:99 apt=98\r\na=rtpmap:100 VP9/90000\r\na=rtcp-fb:100 goog-remb\r\na=rtcp-fb:100 transport-cc\r\na=rtcp-fb:100 ccm fir\r\na=rtcp-fb:100 nack\r\na=rtcp-fb:100 nack pli\r\n
a=fmtp:100 profile-id=2\r\na=rtpmap:101 rtx/90000\r\na=fmtp:101 apt=100\r\na=rtpmap:119 H264/90000\r\n
a=rtcp-fb:119 goog-remb\r\na=rtcp-fb:119 transport-cc\r\na=rtcp-fb:119 ccm fir\r\n
a=rtcp-fb:119 nack\r\na=rtcp-fb:119 nack pli\r\na=fmtp:119 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=64001f\r\n
a=rtpmap:120 rtx/90000\r\na=fmtp:120 apt=119\r\na=rtpmap:123 red/90000\r\na=rtpmap:124 rtx/90000\r\na=fmtp:124 apt=123\r\na=rtpmap:125 ulpfec/90000\r\n
a=ssrc-group:FID 1742994058 2718391150\r\n
a=ssrc:1742994058 cname:eTFvCfcQfV0f9mp+\r\n
a=ssrc:1742994058 msid:9e9126ac-00ee-411c-bd6f-37563df8c4bc 0ced0955-62fd-480e-878f-1820a88d1ea4\r\n
a=ssrc:2718391150 cname:eTFvCfcQfV0f9mp+\r\n
a=ssrc:2718391150 msid:9e9126ac-00ee-411c-bd6f-37563df8c4bc 0ced0955-62fd-480e-878f-1820a88d1ea4\r\n

[2025-10-28 03:04:22.171][INFO][1][8u0718x9] RTC local answer: v=0\r\no=SRS/6.0.181(Hang) 99902663285360 2 IN IP4 0.0.0.0\r\ns=SRSPublishSession\r\nt=0 0\r\na=ice-lite\r\na=group:BUNDLE 0 1\r\na=msid-semantic: WMS live/teststream\r\nm=audio 9 UDP/TLS/RTP/SAVPF 111\r\nc=IN IP4 0.0.0.0\r\na=ice-ufrag:84a9c6ot\r\na=ice-pwd:q354k8290x866mz09244qh6r3656t53z\r\na=fingerprint:sha-256 3B:76:3C:67:22:69:7C:A2:C3:93:1A:32:ED:41:3A:E7:5C:AA:37:F5:A6:E3:70:9E:4E:3A:93:39:FE:65:1B:6D\r\na=setup:passive\r\na=mid:0\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=recvonly\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:111⁠ opus/48000/2\r\na=rtcp-fb:111 transport-cc\r\na=fmtp:111 minptime=10;useinbandfec=1\r\na=candidate:0 1 udp 2130706431 10.0.0.10 8000 typ host generation 0\r\na=candidate:1 1 udp 2130706431 172.17.0.2 8000 typ host generation 0\r\nm=video 9 UDP/TLS/RTP/SAVPF 109 123\r\nc=IN IP4 0.0.0.0\r\na=ice-ufrag:84a9c6ot\r\na=ice-pwd:q354k8290x866mz09244qh6r3656t53z\r\na=fingerprint:sha-256 3B:76:3C:67:22:69:7C:A2:C3:93:1A:32:ED:41:3A:E7:5C:AA:37:F5:A6:E3:70:9E:4E:3A:93:39:FE:65:1B:6D\r\na=setup:passive\r\na=mid:1\r\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=recvonly\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:109⁠ H264/90000\r\na=rtcp-fb:109 transport-cc\r\na=rtcp-fb:109 nack\r\na=rtcp-fb:109 nack pli\r\na=fmtp:109 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f\r\na=rtpmap:123 red/90000\r\na=candidate:0 1 udp 2130706431 10.0.0.10 8000 typ host generation 0\r\na=candidate:1 1 udp 2130706431 172.17.0.2 8000 typ host generation 0\r\n

[2025-10-28 03:04:22.191][INFO][1][8u0718x9] TCP: before dispose resource(HttpConn)(0x5adc66bd4230), conns=1, zombies=0, ign=0, inz=0, ind=0

[2025-10-28 03:04:22.191][WARN][1][8u0718x9][104] client disconnect peer. ret=1007

[2025-10-28 03:04:22.191][INFO][1][0dm7706e] TCP: clear zombies=1 resources, conns=1, removing=0, unsubs=0

[2025-10-28 03:04:22.191][INFO][1][8u0718x9] TCP: disposing #0 resource(HttpConn)(0x5adc66bd4230), conns=1, disposing=1, zombies=0

[2025-10-28 03:04:22.201][INFO][1][8u0718x9] RTC: session address init 172.17.0.1:56518

[2025-10-28 03:04:22.202][INFO][1][8u0718x9] RTC: session STUN done, waiting DTLS handshake.

[2025-10-28 03:04:22.823][INFO][1][37231oh6] Hybrid cpu=1.00%,24MB

[2025-10-28 03:04:22.823][INFO][1][37231oh6] RTC: Server conns=1

[2025-10-28 03:04:23.826][INFO][1][36j18z1y] Live: cleanup die source, id=[], total=1

[2025-10-28 03:04:27.823][INFO][1][37231oh6] Hybrid cpu=1.00%,25MB

[2025-10-28 03:04:27.823][INFO][1][37231oh6] RTC: Server conns=1

[2025-10-28 03:04:27.856][INFO][1][56x4q77q] <- RTC RECV #11, udp 46, pps 4/4, schedule 46

[2025-10-28 03:04:30.180][INFO][1][d73dq001] sig=15, user terminate program, fast quit

[2025-10-28 03:04:30.831][INFO][1][d73dq001] cleanup for quit signal fast=1, grace=0

[2025-10-28 03:04:30.831][WARN][1][d73dq001][11] main cycle terminated, system quit normally.

[2025-10-28 03:04:30.831][WARN][1][025xs8k1][4] inotify ignore read failed, nn=-1

[2025-10-28 03:04:30.931][INFO][1][d73dq001] srs disposed

[2025-10-28 03:04:30.931][INFO][1][d73dq001] srs terminated
